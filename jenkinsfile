pipeline{
    agent any 
    environment{
        IMAGE='hothaifa'
        // VERSION= env.BUILD_NUMBER already exists
    }
    stages{
        stage("clonning movies repo"){
            steps{
                echo 'cloning . . .'
                sh 'git clone https://github.com/devopsPRO27/movies-api'
                // git url:'https://github.com/devopsPRO27/movies-api', branch: 'main'
            }
        }
        stage("building movies image"){
            steps{
                echo ' ****** building the app ****** '
                // var/jenkins_home/workspace/hothiafa's-pipeline/dockertfile
                sh "docker build -t $IMAGE:$BUILD_NUMBER movies/"
            }
            post{
                success{
                    echo 'printing the images . . . '
                    sh "docker images | grep -i $IMAGE "
                }
            }
        }
        stage("testing movies image"){
            steps{
              echo 'testing . . . '
            }
        }
        stage("uploading to dockerhub"){
            steps{
             echo 'uploading . . .'
            }
        }
    }
    post{
        always{
            echo "cleanup"
            sh 'rm -fr movies-api'
        }
    }
}